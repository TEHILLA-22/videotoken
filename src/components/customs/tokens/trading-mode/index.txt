'use client';

import TradingViewWidget from '@/components/shared/chart/trade-view';
import { Card, CardContent } from '@/components/ui/card';
import Link from 'next/link';
import { useSearchParams } from 'next/navigation';
import HistoryTable from '../../table/data-table/history';
import HoldersTable from '../../table/data-table/holders';
import OrdersTable from '../../table/data-table/orders';
import PositionsTable from '../../table/data-table/positions';
import TopTradersTable from '../../table/data-table/top-traders';
import TradesTable from '../../table/data-table/trades';
import TradingControls from './trade-converta';
import VideoSection from './video-section';

type TradingModePanelProps = {
  tokenMint: string;
};

function TradingModePanel({ tokenMint }: TradingModePanelProps) {
  const searchParams = useSearchParams();
  const activeTab = searchParams?.get('tab') || 'video';

  const tabs = [
    { name: 'Video', tab: 'video' },
    { name: 'Orders', tab: 'orders' },
    { name: 'Trades', tab: 'trades' },
    { name: 'Holders', tab: 'holders' },
    { name: 'Top Traders', tab: 'top-traders' },
    { name: 'Positions', tab: 'positions' },
    { name: 'History', tab: 'history' },
  ];

  return (
    <section className="min-w-full flex flex-col justify-between flex-1 pb-6 pt-6">
      <div className="flex flex-col xl:group-data-[collapsible=icon]:flex-row 2xl:flex-row w-full gap-2 justify-between">
        <div className="flex flex-col  w-full flex-1">
          <div className="flex flex-col lg:flex-col xl:flex-row items-start min-w-full gap-3">
            <TradingViewWidget tokenMint={tokenMint} />
          </div>
          <div className="h-auto w-full text-xl text-white/50 urbanist flex flex-col mt-6 gap-2">
            {' '}
            {/* smaller text + spacing */}
            <div className="overflow-x-auto">
              <nav className="flex px-2" aria-label="Settings tabs">
                {' '}
                {/* reduced padding */}
                {tabs.map((tab) => (
                  <Link
                    key={tab.tab}
                    scroll={false}
                    href={`?tab=${tab.tab}`}
                    className={`whitespace-nowrap px-6 py-1.5 border-b-2 font-medium text-xs ${
                      activeTab === tab.tab
                        ? 'text-white border-white'
                        : 'text-gray-300 border-gray-600'
                    } cursor-pointer urbanist`}
                  >
                    {' '}
                    {/* smaller px, border, font */}
                    {tab.name}
                  </Link>
                ))}
              </nav>
            </div>
            {activeTab === 'video' && <VideoSection />}
            {activeTab === 'orders' && <OrdersTable />}
            {activeTab === 'trades' && <TradesTable />}
            {activeTab === 'holders' && <HoldersTable />}
            {activeTab === 'positions' && <PositionsTable />}
            {activeTab === 'history' && <HistoryTable />}
            {activeTab === 'top-traders' && <TopTradersTable />}
          </div>
        </div>
        <div className="min-h-full w-0.5 max-h-full hidden 2xl:flex bg-gradient-to-b from-[#161622] via-[#FFFFFF] to-[#161622]" />
        <div className="flex flex-col max-w-full lg:flex-row xl:flex-row md:max-w-full 2xl:flex-col 2xl:max-w-sm w-full h-full gap-3">
          {' '}
          {/* reduced gap */}
          <TradingControls tokenMint={tokenMint} />
          <div className="flex flex-col items-center justify-between w-full xl:h-full md:max-w-xl lg:max-w-full">
            <Card className="w-full bg-white h-[180px] xl:mt-5 2xl:mt-0 lg:max-w-sm relative flex flex-col items-center justify-center">
              {/* reduced height */}
              <CardContent className="flex flex-col items-center bg-red-600 px-3 py-3 min-w-[160px] rounded-sm justify-center mt-4">
                {/* smaller spacing */}
                <h1 className="text-2xl font-semibold urbanist text-white flex flex-row items-center justify-center">
                  {/* smaller text */}
                  <div className="w-1.5 h-1.5 bg-white rounded-full mr-2" /> Live
                  {/* smaller dot */}
                </h1>
              </CardContent>
            </Card>
          </div>
        </div>
      </div>
    </section>
  );
}

export default TradingModePanel;
